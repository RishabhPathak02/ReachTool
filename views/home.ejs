<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= title %></title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-indigo-200 via-purple-200 to-pink-200 min-h-screen flex items-center justify-center">

  <div class="bg-white/30 backdrop-blur-md p-10 rounded-2xl shadow-xl w-full max-w-xl text-center">
    <h1 class="text-3xl font-bold text-gray-800 mb-6"><%= title %></h1>

    <div class="flex flex-col md:flex-row justify-center items-center gap-4 mb-8">
      <a href="/upload" class="px-6 py-3 rounded-xl bg-indigo-500 hover:bg-indigo-600 text-white font-semibold transition">Upload Feature</a>
      <a href="/feature/celebrities" class="px-6 py-3 rounded-xl bg-green-500 hover:bg-green-600 text-white font-semibold transition">View Celebs Data</a>
      <button id="downloadBtn" aria-label="Download Instagram Report" class="px-6 py-3 rounded-xl bg-yellow-500 hover:bg-yellow-600 text-white font-semibold transition">Download Reach</button>
    </div>

    <div id="progressContainer" class="w-full bg-gray-300 rounded-full overflow-hidden shadow-inner h-8 hidden">
      <div id="progressBar" class="h-full bg-gradient-to-r from-green-400 via-yellow-400 to-pink-500 text-white text-sm font-semibold flex items-center justify-center transition-all duration-500 ease-out" style="width: 0%;">
        0%
      </div>
    </div>

    <p id="statusMessage" class="mt-4 text-sm text-gray-700 hidden"></p>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const downloadBtn = document.getElementById("downloadBtn");
    const progressContainer = document.getElementById("progressContainer");
    const progressBar = document.getElementById("progressBar");
    const statusMessage = document.getElementById("statusMessage");

    socket.on('progressUpdate', (data) => {
      progressContainer.classList.remove('hidden');
      progressBar.style.width = `${data.progress}%`;
      progressBar.innerText = `${data.progress}%`;
    });

    downloadBtn.addEventListener("click", () => {
      downloadBtn.disabled = true;
      statusMessage.classList.add('hidden');
      progressBar.style.width = "0%";
      progressBar.innerText = "0%";
      progressContainer.classList.remove('hidden');

      fetch("/download/csv")
        .then(response => response.blob())
        .then(blob => {
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = "instagram_report.csv";
          document.body.appendChild(a);
          a.click();
          a.remove();
          statusMessage.innerText = "âœ… Download complete!";
          statusMessage.classList.remove('hidden');
        })
        .catch(err => {
          alert("Download failed: " + err.message);
        })
        .finally(() => {
          downloadBtn.disabled = false;
          setTimeout(() => {
            progressContainer.classList.add('hidden');
            progressBar.style.width = "0%";
          }, 3000);
        });
    });
  </script>

</body>
</html>
